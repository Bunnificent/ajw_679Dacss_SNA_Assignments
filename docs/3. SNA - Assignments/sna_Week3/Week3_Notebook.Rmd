---
title: "R Notebook"
output: html_notebook
---

```{r setup, Libraries, include=FALSE}

knitr::opts_chunk$set(echo = FALSE)

# Document Creation
library(knitr)
library(markdown)
library(yaml)
library(distill)
library(blogdown)

# Basic Analysis
library(ggplot2)
library(tidyverse)
library(clipr)
library(dbplyr)
library(data.table)
library(stringr)
library(stringi)
library(tibble)
library(tidyr)

# SNA - Social Network Analysis

library(tergm)
library(ergm)
library(network)
library(networkDynamic)
library(networkDynamicData)

library(statnet)
library(igraph)
library(igraphdata)
library(tsna)
library(sna)

```

```{r Set Working Directory, include=FALSE}
getwd()

setwd("C:/Users/white/iCloudDrive/Documents/1_DACSS_UMassAmherst/Dacss_RProjects/3. Sp22_rProjects/Dacss_679- Coursework/GIT-ajw_Learning-SocialNetworkAnalysis/docs/3. SNA - Assignments/sna_Week3")


```


## Basic R: Import & Clean Data

```{r Read raw data into R}

library(readr)

indx_SmugglerCove_recip <- read_csv("C:/Users/white/iCloudDrive/Documents/1_DACSS_UMassAmherst/Dacss_RProjects/3. Sp22_rProjects/Dacss_679- Coursework/GIT-ajw_Learning-SocialNetworkAnalysis/docs/3. SNA-Data/index-by_name-Smuggler_Cove-cocktail_recipies.csv", 
    col_names = FALSE, 
    col_types = cols(X1 = col_skip(),
                     X4 = col_skip()), 
                    na = "empty")

View(indx_SmugglerCove_recip)
summary(indx_SmugglerCove_recip)

 # Smuggler's Cove

smugCovIdx <- indx_SmugglerCove_recip

```

```{r Getting Information on a Dataset:, echo=FALSE}

# list the structure of smugCovIdx
str(smugCovIdx)

# class of an object (numeric, matrix, data frame, etc)
class(smugCovIdx)

# list the variables in smugCovIdx
names(smugCovIdx)

# dimensions of an object
dim(smugCovIdx)
```

```{r & Clean Data}

  library(stringr)
      # Drop NA rows
smugCovIdx <- na.omit(smugCovIdx) 

# DATA Cleaning


#     Extract variables
#####

          # extract first word of the column, adds values in new Column at the end of DF

                    #1st pastIt
passIt <- smugCovIdx      

colnames(passIt)
                    #2nd passIt
passIt$substring_first <- 
  str_extract(passIt$X5,"(\\w+)") 

#####

#####
#     Drop it like...
#####
      # DROP COLUMNS FROM DATA FRAME
                      
                      #3rd PassIt
passIt = subset(passIt, 
                       select = -c(3)
                       )
colnames(passIt)
#####

#####
#     Give Variables a human name
#####

# rename column names with human language

                      # Return it
smugCovIdx <- passIt

names(smugCovIdx )[1] <- "dnkName"
names(smugCovIdx )[2] <- "dnkIng"
names(smugCovIdx )[3] <- "ingType"

colnames(smugCovIdx)
```

# Network: Creating network Data
```{r HOLD: EDGELIST: IGRAPH: create a network object from the dataset, eval=FALSE, include=FALSE}

colnames(smugCovIdx )
 
# [1] "dnkName" "dnkIng"  "ingType"
# V1 <- "dnkName" 
# V2 <- "dnkIng"  
# EA <- "ingType"
dr_smugCov <- smugCovIdx

 ##If data are in edgelist format (A) and are undirected (B), use the following command:#

#igraph object 
network_ig<- graph.edgelist(as.matrix(smugCovIdx[1:2]), directed=F) 

#  Adding edge and node attributes to network/graph object 

#If you have edgelist data, edge attributes will often be stored in same data file
#iGraph will read in all edge attributes automatically, inspect as follows
edge_attr(network_ig)

##but to create new edge attribute if edges sorted correctly
# E(network_ig)$COLNAME<-edge.attribute$COLNAME

#The vertex names in this file must exactly match those in the network#
#sometimes this requires using as.character(x) to change from factor to character
#create vertex attributes in igraph
# V(network_ig)[match(V(network)$name,vertex_attributes$VERTEX_NAME)]$COLNAME<-
#  vertex_attributes$COLNAME



```

```{r NETWORK EDGELIST: Statnet & Igraph, include=FALSE}
#Lets read the data into the enviroment.
#This will import it formatted as an edgelist

source_netEdge <- smugCovIdx

# Identify Edge Vertices and Edge Attributes

colnames(source_netEdge)
# [1] "dnkName" "dnkIng"  "ingType"
# V1 <- "dnkName" 
# V2 <- "dnkIng"  
# EA <- "ingType"


# Lets create an statnet object from our edgelist
#####
#First we make the object. It will have no vertex or edge attributes
sourceEL_sn <- 
  network(as.matrix(source_netEdge[1:2], 
                    matrix.type = 'edgelist',
                    loops=T,
                    hyper=T)
  )
print(sourceEL_sn)

#**%e%** Let's add edge atributes, do not include the colNames for edge vertex

sourceEL_sn%e%"ingType" <- source_netEdge$ingType
sourceEL_sn%e%"dnkIng" <- source_netEdge$dnkIng

print(sourceEL_sn)

sourceEL_sn%v%"dnkName"<- sourceEL_sn%v%"vertex.names",source_netEdge$dnkName

print(sourceEL_sn)
# Generating the EdgeList
#####
##**round 1**
          # from "_netEdge" select "colNames" to be identified with "vertex.names"

temp <- source_netEdge[,c("dnkName")]


View(temp)
##**round 2**
            # code still selecting from "_netEdge", add "colNames"

 colnames(temp)<- c("dnkIng")
# View(temp)

##**round 3**
            # "rBind" selects "colnames" from "_netEdge" and BINDS them to temp

temp <- rbind(temp,source_netEdge[, c("dnkIng")])

View(temp)
#######

##**final round** !!! is being used as variable in generating an edgelist object
                # temp contains 
        

sourceEL_sn%v%"dnkName"<- 
  temp$dnkName[match(sourceEL_sn%v%"vertex.names",
                    temp$dnkName)]
      #####
            summary(sourceEL_sn)
View(sourceEL_sn)

#####

  
#     access edge attribute
#  head(smugEL_sn%e% "weight")

#####


              # it's a bloody statnet edgelist !!!
 
#**igraph** version of the network
#####
          # NOTE: igraph automatically adds edge attributes, but not vertices 
    
    #First let's create the object. 

sourceEL_ig <- smugCovIdx

sourceEL_ig <- graph_from_data_frame(d = sourceEL_ig, directed = FALSE)



#####
      #**igraph** Generate Edgelist
######

V(sourceEL_ig)$dnkName<-
  temp$dnkIng[
    match(V
          (sourceEL_ig)$name,
          temp$dnkIng)
  ]
# print(sourceEL_ig )
# edge_attr(sourceEL_ig)

#########
########
          smugEL_sn  <- sourceEL_sn
          smugEL_ig <- sourceEL_ig
          
            # list the structure of smugCovIdx
    str(smugEL_ig )
    str(smug_sn)

```


# Network Info
  Network Objects: EDGE LIST
                  STATNET: smugEL_sn
                  IGRAPH: smugEL_ig
          
```{r}

colnames(smugCovIdx)
#Lets make some network objects

smugCovIdx_igraph <- graph_from_data_frame(smugCovIdx)
print(smugCovIdx_igraph)

 
#Now let's create a statnet object

network_edgelist <- smugCovIdx

network_statnet <- network(as.matrix(network_edgelist[,c("dnkName")]), 
                             directed = FALSE, matrix.type = "edgelist")

  network_statnet%e%'dnkIng'  <- smugCovIdx$dnkIng
  network_statnet%e%'ingType' <- smugCovIdx$ingType


    
  network_statnet%v%'dnkName'<-
    as.character(smugCovIdx$dnkName[match(smugCovIdx,network_statnet%v%'vertex.names')])
  
print(network_statnet)
  
                                 #     access vertex attributes
  view(network_statnet%v% "vertex.names")
            # list the names of vertex attributes
  network::list.vertex.attributes(network_statnet)
            #  Generate a list the names of edge attributes
  network::list.edge.attributes(network_statnet)
            #   summarize numeric network attribute
  summary(network_statnet%v%"dnkName")

```


## Smuggler's Cove Index- NETWORK: EDGELIST: Features & Descriptions
```{r Network: Identify critical features, echo=FALSE}

#**Statnet EdgeList**   smugEL_sn
#####

```

```{r STATNET: Network Description}
    
      # class of an object
class(smugEL_sn )

      # list the structure of smugCovIdx
str(smugEL_sn )

      ## Network Attributes
 print(smugEL_sn)
          # Vertices =  
          # Directed = 
          # hyper = 
          # loops = 
          # multiple = 
          # bipartite = 
          # total edges = 
                # missing edges =
                # non-missing edges = 
          # Vertex attribute names:
          # Edge Attribute Names: 
```


```{r igraph: Network Description, echo=TRUE}
  
      # class of an object
    class(smugEL_ig )
    
## Network Size
      # Count Vertices
    vcount(smugEL_ig)
    
      # Count Edges
    ecount(smugEL_ig)

## Network Mode
    # Bipartitie / Unimodal
    is_bipartite(smugEL_ig)

## Edges    
    # Un/directed 
    is_directed(smugEL_ig)

    # weighted or unweighted?
    is_weighted(smugEL_ig)        
    
```


**Vertex and Edge Attributes**

```{r statnet: Attribute Data: Directed: Adjacency Network, echo=TRUE}

# class of an object
    class(smugEL_sn)

#     access vertex attributes
  view(smugEL_sn %v% "vertex.names")

#      list the names of vertex attributes
  network::list.vertex.attributes(smugEL_sn)

#     access edge attribute
#  head(smugEL_sn%e% "weight")

#  Generate a list the names of edge attributes
  network::list.edge.attributes(smugEL_sn)
 
#   summarize numeric network attribute
  summary(smugEL_sn  %v% "name")
  
```

```{r igraph: Attribute Data: Directed: Adjacency Network, echo=TRUE}

#     access vertex attribute 
  V(smugEL_ig)$name
#     Generate a list the names of vertex attributes
  igraph::vertex_attr_names(smugEL_ig)

#     access edge attribute
  E(smugEL_ig)$weight

#   Generate a list the names of edge attributes  
  igraph::edge_attr_names(smugEL_ig)

```



#   Week 2: Scripts
##    Network: Describe Network Data
##    *Identify and describe content of nodes and
    links,*

Vertex attribute names: vertex.names

3.  *Identify whether attribute data are present.*

```{r Summary,echo=TRUE}
  
  summary(smugCovIdx,
          print.adj = TRUE
          )
```

#       Explore the dataset using commands from week 2 tutorial.

5.  *geodesic and path distances,*

## Path Length and Geodesic

```{r iGraph:Nodes: Path: Length, echo=TRUE}

#     Calculate distances between two nodes
    distances(smugEL_ig,"node 1","node 2")

#     Calculate distance between two nodes using unweighted edges
    distances(smugEL_ig,"node 1", "node 5",weights=NA)
    
```

We can also find all of the shortest paths between
two famalies in this network. These list the
starting node and the ending node with all nodes
inbetween for each path. The option weights=NA
means that any available edge weights are ignored.

```{r iGraph:Nodes: Path: Shortest, echo=TRUE}
    
#     isolating the distances between specific node
    all_shortest_paths(smugEL_ig,"node 3","node 4", weights=NA)$res
## Note: manually tell igraph to ignore edge weights.
```

The concept of shortest path to describe the
overall network structure can be more useful

```{r iGraph:Network: Path: Shortest, echo=TRUE}

#     find average shortest path for network
    average.path.length(smugEL_ig,directed=F)    
  
```

6.  *triads or transitivity,*

## Dyad Census

Classifies all dyads in the network as: -
Reciprocal (mutual), or 
mut - Asymmetric (non-mutual), or 
asym, and - 
Absent, or null

```{r statnet: Dyad Census , echo=TRUE}

    sna::dyad.census(smugEL_sn)

```

```{r iGraph: Dyad Census, echo=TRUE}

  igraph::dyad.census(smugEL_ig)

```

## Triad Census

Classifies all triads in the network. The triad
census provides a fundamental descriptive insight
into the types of triads found in a particular
smugEL_

```{r statnet: Triad Census, echo=TRUE}

#     Classify all Triad in the network: Directed Network

  sna::triad.census(smugEL_sn, mode= )

#     Classify all Triad in the network: Undirected Network
   sna::triad.census(smugEL_sn, mode="graph")

#     total number of all four triad types returned by triad census
   sum(sna::triad.census(smugEL_sn, mode="graph"))
   
   
```

```{r iGraph: Triad Census, echo=TRUE}
#Classify all Triad in the network
     igraph::triad_census(smugEL_ig)

```

## Transitivity or Global Clustering

```{r iGraph: weighted/ network transitivity, echo=TRUE}

#     network transitivity:
    transitivity(smugEL_ig)

#     weighted network transitivity:
#   igraph::transivity(smugEL_ig)

```

```{r statnet: weighted/ directed network transitivity, echo=TRUE}

#     Directed Networks transitivity:
  gtrans(smugEL_sn)

#   methods for weighted networks, rank and correlation, along with the relevant references.
#  sna::gtrans()
  
```

## Local Transivity or Clustering

`Local transitivity` (local clustering
coefficient), is a technical description of the
density of an ego network.

```{r iGraph:Local transitivity, echo=TRUE}

#     Retrive a list of the vertices we are interested
    V(smugEL_ig)[c("node 1" ,
                "node 5", 
                "node 6",
                "node 2")]

#     check ego network transitivity
transitivity(smugEL_ig,
             type="local", 
             vids=V(smugEL_ig)
             [c("node 1",
                "node 5", 
                "node 6",
                "node 2")]) 
#     get global clustering cofficient
  transitivity(smugEL_ig, type="global")

#     get average local clustering coefficient
  transitivity(smugEL_ig, type="average")

```

7.  *connectedness and.or component structure,
    etc.*

Distill is a publication format for scientific
and technical writing, native to the web.
>
Learn more about using Distill for R Markdown at
<https://rstudio.github.io/distill>. ##
