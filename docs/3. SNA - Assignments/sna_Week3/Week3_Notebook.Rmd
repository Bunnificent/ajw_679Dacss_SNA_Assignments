---
title: "R Notebook"
output: html_notebook
---

```{r setup, Libraries, include=FALSE}

knitr::opts_chunk$set(echo = FALSE)

# Document Creation
library(knitr)
library(markdown)
library(yaml)
library(distill)
library(blogdown)

# Basic Analysis
library(ggplot2)
library(tidyverse)
library(clipr)
library(dbplyr)
library(data.table)
library(stringr)
library(stringi)
library(tibble)
library(tidyr)

# SNA - Social Network Analysis

library(tergm)
library(ergm)
library(network)
library(networkDynamic)
library(networkDynamicData)

library(statnet)
library(igraph)
library(igraphdata)
library(tsna)
library(sna)

```

```{r Set Working Directory, include=FALSE}
getwd()

setwd("C:/Users/white/iCloudDrive/Documents/1_DACSS_UMassAmherst/Dacss_RProjects/3. Sp22_rProjects/Dacss_679- Coursework/GIT-ajw_Learning-SocialNetworkAnalysis/docs/3. SNA - Assignments/sna_Week3")


```


## Basic R: Import & Clean Data

```{r Read raw data into R}

library(readr)

indx_SmugglerCove_recip <- read_csv("C:/Users/white/iCloudDrive/Documents/1_DACSS_UMassAmherst/Dacss_RProjects/3. Sp22_rProjects/Dacss_679- Coursework/GIT-ajw_Learning-SocialNetworkAnalysis/docs/3. SNA-Data/index-by_name-Smuggler_Cove-cocktail_recipies.csv", 
    col_names = FALSE, 
    col_types = cols(X1 = col_skip(),
                     X4 = col_skip()), 
                    na = "empty")

View(indx_SmugglerCove_recip)
summary(indx_SmugglerCove_recip)

 # Smuggler's Cove

smugCovIdx <- indx_SmugglerCove_recip

```

```{r Getting Information on a Dataset:, echo=FALSE}

# list the structure of smugCovIdx
str(smugCovIdx)

# class of an object (numeric, matrix, data frame, etc)
class(smugCovIdx)

# list the variables in smugCovIdx
names(smugCovIdx)

# dimensions of an object
dim(smugCovIdx)
```

```{r & Clean Data}

  library(stringr)
      # Drop NA rows
smugCovIdx <- na.omit(smugCovIdx) 

# DATA Cleaning


#     Extract variables
#####

          # extract first word of the column, adds values in new Column at the end of DF

                    #1st pastIt
passIt <- smugCovIdx      

colnames(passIt)
                    #2nd passIt
passIt$substring_first <- 
  str_extract(passIt$X5,"(\\w+)") 

#####

#####
#     Drop it like...
#####
      # DROP COLUMNS FROM DATA FRAME
                      
                      #3rd PassIt
passIt = subset(passIt, 
                       select = -c(3)
                       )
colnames(passIt)
#####

#####
#     Give Variables a human name
#####

# rename column names with human language

                      # Return it
smugCovIdx <- passIt

names(smugCovIdx )[1] <- "dnkName"
names(smugCovIdx )[2] <- "dnkIng"
names(smugCovIdx )[3] <- "ingType"

colnames(smugCovIdx)
```

#   Project Varriables
    
    Raw Data:
  indx_SmugglerCove_recip

    DataFrame:
  smugCovIdx
  network_nodes <- smugCovIdx << "dnkName"
    
    Matrix:
  smug_matrix
  network_edgelist <- smug_matrix
        
    Network Objects: EDGE LIST
  STATNET: smugEL_sn
  IGRAPH: smugEL_ig

# Network Info
  Network Objects: EDGE LIST
                  STATNET: smugEL_sn
                  IGRAPH: smugEL_ig
          
```{r EDGELIST: Network Objects: statnet & igraph, include=FALSE}

#Lets make some network objects

colnames(smugCovIdx) 
# tell R data should be understood as a matrix
smug_matrix = as.matrix(smugCovIdx,
                        matrix.type="edgelist",
                        directed=FALSE) 
head.matrix(smug_matrix)

network_edgelist <- smug_matrix

  network_nodes <- smugCovIdx 
    network_nodes<- 
      select(network_nodes,
             dnkName)

        ### View(network_nodes)
    
######
      ######**igraph** 
######
        #igraph object 
network_ig <- 
  graph.edgelist(
    as.matrix(
      smugCovIdx[1:2]), 
    directed=F)
                ## create new edge attribute
  E(network_ig)$dnkIng<-smugCovIdx$dnkIng
  E(network_ig)$ingType<-smugCovIdx$ingType
  #create vertex attributes in igraph
 V(network_ig)[match(V(network_ig)$dnkName,network_nodes$dnkName)]$dnkName<-
   network_nodes$dnkName
  
      summary(edge_attr(network_ig))
     
  # head(network_ig)
  # summary(network_ig)
      ######
 
#####
      #####**statnet** 
#####    
  network_edgelist <- smugCovIdx
 
  network_nodes <- smugCovIdx 
  network_nodes<- 
    select(network_nodes,
           dnkName)
summary(network_nodes)
View(network_nodes)

  #Now let's create a statnet object
  network_statnet <- network(network_edgelist, 
                             matrix.type = "edgelist",
                             vertex.attr = network_nodes,
                             multiple = T)
  
  network_statnet%e%'dnkIng'  <-
    network_edgelist$dnkIng
  
  network_statnet%e%'ingType'<- 
    network_edgelist$ingType

       # list the names: vertex attributes
  view(network_statnet%v% "vertex.names")
  
summary(network_statnet)
        #####

 ## Network Objects: EDGE LIST
              ##**STATNET:**
  smugEL_sn <- network_statnet
  
                ##**IGRAPH:** 
  smugEL_ig <- network_ig
  
```

## Smuggler's Cove Index- NETWORK: EDGELIST: Features & Descriptions

```{r STATNET: Network Description, include=FALSE}
    
      # class of an object
  class(smugEL_sn )

## access vertex attributes
            # list the names:  vertex attributes
  network::list.vertex.attributes(smugEL_sn)
  
            # list the names:  edge attributes
  network::list.edge.attributes(smugEL_sn)
      #   summarize: numeric network attribute
  summary(smug_sn%v%"dnkName")

## Network Attributes
 print(smugEL_sn)
          # Vertices =  
          # Directed = 
          # hyper = 
          # loops = 
          # multiple = 
          # bipartite = 
          # total edges = 
                # missing edges =
                # non-missing edges = 
          # Vertex attribute names:
          # Edge Attribute Names: 

##**NOTE** large quantity of output 
      
  # list the structure of smugCovIdx
# str(smugEL_sn)
```

smugEL_sn

[1] "network"

Network attributes:
  vertices = 274 
  directed = TRUE 
  hyper = FALSE 
  loops = FALSE 
  multiple = TRUE 
  bipartite = FALSE 
  total edges= 672 
    missing edges= 0 
    non-missing edges= 672 

 Vertex attribute names: 
    dnkName vertex.names 

 Edge attribute names: 
    dnkIng ingType 
    
    
```{r igraph: Network Description, echo=TRUE}
  
      # class of an object
    class(smugEL_ig )
    
## Network Size
      
      # Count Vertices
    vcount(smugEL_ig)
    
      # Count Edges
    ecount(smugEL_ig)

## Network Mode
    # Bipartitie / Unimodal
    is_bipartite(smugEL_ig)

## Edges    
    # Un/directed 
    is_directed(smugEL_ig)

    # weighted or unweighted?
    is_weighted(smugEL_ig)      
    
    # edge weights
    E(smugEL_ig)$weight

## access vertex attributes
    
    # Generate a list the names of vertex attributes
  V(smugEL_ig)$name

    # access edge attribute  names
  igraph::vertex_attr_names(smugEL_ig)

    # Generate a list the names of edge attributes  
  igraph::edge_attr_names(smugEL_ig)
  

## Network Attributes
 summary(smugEL_ig)
          # Vertices =  
          # Directed = 
          # hyper = 
          # loops = 
          # multiple = 
          # bipartite = 
          # total edges = 
                # missing edges =
                # non-missing edges = 
          # Vertex attribute names:
          # Edge Attribute Names: 
```
smugEL_ig

[1] "igraph"

Network attributes:
  vertices = 274 
  directed = FALSE
  hyper = FALSE 
  loops = FALSE 
  multiple = TRUE 
  bipartite = FALSE 
  total edges= 672 
    missing edges= 0 
    non-missing edges= 672 

 Vertex attribute names: 
    dnkName vertex.names 

 Edge attribute names: 
    dnkIng ingType 
    


#   Week 2: Basic Network Structure: Smuggler's Cove Drink Index

## Path Length and Geodesic


```{r iGraph:Network: Path: Shortest, echo=TRUE}

#     find average shortest path for network
    average.path.length(smugEL_ig,directed=F)    
  
```   
  

```{r iGraph: Specific Nodes: Path: Shortest, echo=TRUE}
    
#     isolating the distances between specific node
    all_shortest_paths(smugEL_ig,"Strozzi","Tornabuoni", weights=NA)$res
## Note: manually tell igraph to ignore edge weights.
```   
    
    
```{r iGraph: Specific Nodes: Path: Length, echo=TRUE}

#     Calculate distances between two nodes
    distances(smugEL_ig,"Bischeri","Ridolfi")

#     Calculate distance between two nodes using unweighted edges
    distances(smugEL_ig,"Bischeri", "Castellani",weights=NA)
    
```


## Dyad Census
Classifies all dyads in the network as: - 
Reciprocal (mutual), 
or mut - Asymmetric (non-mutual), 
or asym, 
and - Absent, or null

```{r statnet: Dyad Census , echo=TRUE}

    sna::dyad.census(smugEL_sn)

```

```{r iGraph: Dyad Census, echo=TRUE}

  igraph::dyad.census(smugEL_ig)

```

## Triad Census

Classifies all triads in the network. 
The triad census provides a fundamental descriptive insight into the types of triads found in a particular dataset.

```{r statnet: Triad Census, echo=TRUE}

#     Classify all Triad in the network: Undirected Network
   sna::triad.census(smugEL_sn, mode="graph")

#     total number of all four triad types returned by triad census
   sum(sna::triad.census(smugEL_sn, mode="graph"))
   
   
```

```{r iGraph: Triad Census, echo=TRUE}
#Classify all Triad in the network
     igraph::triad_census(smugEL_ig)

```


## Transitivity or Global Clustering

```{r iGraph: weighted/ network transitivity, echo=TRUE}

#     network transitivity:
    transitivity(smugEL_ig)

```

```{r statnet: weighted/ directed network transitivity, echo=TRUE}

#     Directed Networks transitivity:
  gtrans(smugEL_sn)

#   methods for weighted networks, rank and correlation, along with the relevant references.
#  sna::gtrans()
  
```


## Local Transivity or Clustering
`Local transitivity` (local clustering coefficient), is a technical description of the density of an ego network.

```{r iGraph:Local transitivity, echo=TRUE}

#     Retrive a list of the vertices we are interested
    V(smugEL_ig)[c("Bischeri" ,
                "Castellani", 
                "Medici",
                "Ridolfi")]

#     check ego network transitivity
transitivity(smugEL_ig,
             type="local", 
             vids=V(smugEL_ig)
             [c("Bischeri",
                "Castellani", 
                "Medici",
                "Ridolfi")]) 
#     get global clustering cofficient
  transitivity(smugEL_ig, type="global")

#     get average local clustering coefficient
  transitivity(smugEL_ig, type="average")

```

## Component Structure and Isolates

```{r Statnet: Isolates, echo=TRUE}

              ## Isolates:
 
 #List the isolates
 isolates(smugEL_sn)
 
 # Returns a list of the isolates in the graph or graph set
 isolates(smugEL_sn, diag=FALSE)
 
 # Is Ego an Isolate?
 is.isolate(smugEL_sn, ego, g=1, diag=FALSE)
 
 # Adds n isolates to the graph (or graphs)
 add.isolates(smugEL_sn, n, return.as.edgelist = FALSE)
  
```

```{r igraph: Component Structure, echo=TRUE}
                ## Component Structure: 
 
    # Number of components
 igraph::components(smugEL_ig)$no 
 
  # Size of each component
 igraph::components(smugEL_ig)$csize 

 
```


## Network Density
 
 The density of a network is defined as the proportion of ties present out of all possible ties in a network. 
 

 **Note:**
 
 the network density command ignores edge values at present. 
 
 If loops are present or there are multiple edges between two nodes, then the results may not make sense.
 
 
```{r Statnet, echo=TRUE}

# get network density: with possible loops
 network.density(smugEL_sn)
 
 # get network density without loops: statnet
 gden(smugEL_sn, diag=FALSE)
 
  
```

 **Igraph** provides an incorrect density calculation as the default assumes  that loops are not included but does not remove them. 
 
 Therefore, the default calculation includes the loops in the numerator but not the denominator of the density calculation.

```{r igraph: network density, echo=TRUE}
#get network density without loops: igraph
 network.density(smugEL_ig,loops=TRUE)
 
 
 # get network density
 network.density(smugEL_ig)
 # provides an incorrect density calculation as the default assumes that loops are not included but does not remove them
 
```

## Vertex Degree
 **Vertex degree** is a description of an individual node; each vertex in a network may have a different node degree.
 
 
 *Node Degree:*
   node degree is one measure of node centrality or popularity; 
 Node degree cis a count of the relationships that a node is involved in or the count of the edges that are incident to a vertex
 
 **use the network degree command to:**
   *  compute network summary statistics (such as average network degree);
 *  graph the network degree distribution; or
 *  identify particular nodes (such as the five nodes with the most contacts).
 


```{r Statnet: Vertex Degree, echo=TRUE}

      # statnet: Calculate average network degree
 
  sna::degree(smugEL_sn)
          # ignores loops or self-nominations 


```

```{r igraph: Vertex Degree, echo=TRUE}
# igraph: Calculate average network degree
 # provides node name along with node degree
 
 # includes loops
 igraph::degree(smugEL_ig)

```




## Network Degree Summary Statistics

```{r Statnet: , echo=TRUE}
      # Basic R: get summary statistics for node attributes
 summary(network_nodes)
      # provides range, mean, median and standard deviation of a vector.

 # get summary statistics for node degree for the binary network degree
 
 summary(data.frame(
   name=smugEL_sn%v%"vertex.names",
   totdegree=sna::degree(smugEL_sn),
   indegree=sna::degree(smugEL_sn, cmode="indegree"),
   outdegree=sna::degree(smugEL_sn, cmode="outdegree")
 ))
  
```

#Visualizations

## igraph Visualizations
igraph provides three different ways for visualization.
```{r igraph: , echo=TRUE}

plot.igraph(smugEL_ig)

 # uses regular R graphics and can be used with any R device.

#  (Tk is quite resource hungry, so don't try this for very large graphs.)
 
 tkplot(smugEL_ig)

```


```{r Statnet: Visualization, echo=TRUE}

 # add in vertex labels and change the size and color of these labels
 gplot(smugEL_sn, 
       displaylabels=TRUE,
       label.cex=.75, 
       label.col="black"
 )
 
 # For directed graphs, you can turn off the arrows
 gplot(smugCovIdx, 
       displaylabels=TRUE, 
       label.cex=.75, 
       label.col="black", 
       usearrows = FALSE)
 
 # differentiate nodes based on their attributes
 gplot(smugEL_sn, 
       displaylabels=TRUE,
       label.cex=.75,
       label.col="black",
       vertex.col=att$dnkName
 )
 
 legend("bottomleft",
        fill=0:4,
        legend=paste("DEPT",0:4),
        cex=0.75
 )
 
 # changed the shape of the nodes based on the level of their positions. 
 ## You change the shape of the nodes by specifying the number of sides you want the shape to have using the vertex.sides argument. 
 gplot(smugEL_sn, 
       displaylabels=TRUE,
       label.cex=.75,
       label.col="black",
       vertex.cex = 2,
       vertex.sides=(att$LEVEL+2)
 )
 
  
```

```{r Statnet: , echo=TRUE}

  
```


## Visualization: ggplot2
```{r Visualization: ggplot2}

# Dependencies
 library(network)
 library(sna)
 library(ggplot2)
 
library(visNetwork)
library(threejs)
 library(networkD3)
 library(ndtv)
 # ggnetwork - This package allows to pass network objects to ggplot2 and provides geometries to plot their elements.
 
 library(ggnetwork)
 
  # visualize your network graphs 
 library(GGally)

## [network visualization with ggplot2]




```


#
```{r Statnet: , echo=TRUE}

  
```

```{r igraph: , echo=TRUE}

```

Distill is a publication format for scientific
and technical writing, native to the web.
>
Learn more about using Distill for R Markdown at
<https://rstudio.github.io/distill>. ##
